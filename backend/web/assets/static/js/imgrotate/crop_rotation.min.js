var fnImageCropRot=function(e){if("object"===typeof e&&"img"===e.tagName.toLowerCase()){var g=e.width,f=e.height;e.height=f;var v=new Image;v.src=e.src;var c=v.width,v=v.height;if(g&&c){var x=g/c,y=f/v,k=document.createElement("div");k.style.position="relative";k.style.width=g+"px";k.style.height=f+30+"px";k.style.top="30px";var a=function(a){return document.getElementById(a)};e.parentNode.insertBefore(k,e);var q=80,r=80,n=(g-q)/2,p=(f-r)/2;k.innerHTML='<div style="font-size:12px; position:absolute; top:-24px; right:0;">\u65cb\u8f6c\uff1a<input id="zxxRotAngle" type="text" value="0" style="width:38px; height:15px; border:1px solid #a0b3d6; font-size:100%; padding:2px 0 1px 2px; margin-right:3px; color:#333333;" />\u5ea6</div><canvas id="zxxImageCanvas" style="position:absolute;"></canvas><div id="zxxCropBox" style="height:'+
r+"px; width:"+q+"px; position:absolute; left:"+n+"px; top:"+p+'px; border:1px solid black;"><div id="zxxDragBg" style="height:100%; background:white; opacity:0.3; filter:alpha(opacity=30); cursor:move;"></div><div id="dragLeftTop" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; left:-3px; top:-3px; cursor:nw-resize;"></div><div id="dragLeftBot" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; left:-3px; bottom:-3px; cursor:sw-resize;"></div><div id="dragRightTop" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; right:-3px; top:-3px; cursor:ne-resize;"></div><div id="dragRightBot" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; right:-3px; bottom:-3px; cursor:se-resize;"></div><div id="dragTopCenter" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; top:-3px; left:50%; margin-left:-3px; cursor:n-resize;"></div><div id="dragBotCenter" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; bottom:-3px; left:50%; margin-left:-3px; cursor:s-resize;"></div><div id="dragRightCenter" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; right:-3px; top:50%; margin-top:-3px; cursor:e-resize;"></div><div id="dragLeftCenter" style="position:absolute; width:4px; height:4px; border:1px solid #000; background:white; overflow:hidden; left:-3px; top:50%; margin-top:-3px; cursor:w-resize;"></div></div><input type="hidden" id="cropPosX" value="'+
n/x+'" /><input type="hidden" id="cropPosY" value="'+p/y+'" /><input type="hidden" id="cropImageWidth" value="'+q/x+'" /><input type="hidden" id="cropImageHeight" value="'+r/y+'" />';var w=a("zxxImageCanvas");window.ActiveXObject&&window.G_vmlCanvasManager&&(w=window.G_vmlCanvasManager.initElement(w));k.insertBefore(e,w);a("zxxRotAngle").onkeyup=function(){var a=parseInt(this.value,10);a||(a=0);var b=w,c=a;c||(c=0);var c=Math.PI*c/180,z=Math.round(1E3*Math.cos(c))/1E3,A=Math.round(1E3*Math.sin(c))/
1E3;b.height=Math.abs(z*f)+Math.abs(A*g);b.width=Math.abs(z*g)+Math.abs(A*f);var d=b.getContext("2d");d.save();c<=Math.PI/2?d.translate(A*f,0):c<=Math.PI?d.translate(b.width,-z*f):c<=1.5*Math.PI?d.translate(-z*g,b.height):d.translate(0,-A*g);d.rotate(c);d.drawImage(e,0,0,g,f);d.restore();e.style.display="none";k.style.height=0<a?w.height+30+"px":f+30+"px"};var t=0,u=0,l=0,m=0,C=0,D=0,B=!1,h="drag",d=function(a,b){return a.currentStyle?a.currentStyle[b]:document.defaultView.getComputedStyle(a,!1)[b]},
c=function(c,b,e){l=d(b,"width");m=d(b,"height");"auto"!==d(b,"left")&&(t=d(b,"left"));"auto"!==d(b,"top")&&(u=d(b,"top"));c.onmousedown=function(b){h=e;B=!0;b||(b=window.event);C=b.clientX;D=b.clientY;c.onselectstart=function(){return!1};return!1};document.onmouseup=function(){B=!1;"auto"!==d(b,"left")&&(t=d(b,"left"));"auto"!==d(b,"top")&&(u=d(b,"top"));l=d(b,"width");m=d(b,"height");n=parseInt(b.style.left);p=parseInt(b.style.top);q=parseInt(b.style.width);r=parseInt(b.style.height);0>n&&(n=0);
0>p&&(p=0);n/=x;p/=y;q/=x;r/=y;a("cropPosX").value=n;a("cropPosY").value=p;a("cropImageWidth").value=q;a("cropImageHeight").value=r};document.onmousemove=function(a){var c=a?a:window.event;B&&(a=c.clientX-C,c=c.clientY-D,"n"===h?(b.style.top=parseInt(u)+c+"px",b.style.height=parseInt(m)-c+"px"):"w"===h?(b.style.left=parseInt(t)+a+"px",b.style.width=parseInt(l)-a+"px"):"e"===h?b.style.width=parseInt(l)+a+"px":"s"===h?b.style.height=parseInt(m)+c+"px":"nw"===h?(b.style.left=parseInt(t)+a+"px",b.style.width=
parseInt(l)-a+"px",b.style.top=parseInt(u)+c+"px",b.style.height=parseInt(m)-c+"px"):"ne"===h?(b.style.top=parseInt(u)+c+"px",b.style.height=parseInt(m)-c+"px",b.style.width=parseInt(l)+a+"px"):"sw"===h?(b.style.left=parseInt(t)+a+"px",b.style.width=parseInt(l)-a+"px",b.style.height=parseInt(m)+c+"px"):"se"===h?(b.style.width=parseInt(l)+a+"px",b.style.height=parseInt(m)+c+"px"):(b.style.left=parseInt(t)+a+"px",b.style.top=parseInt(u)+c+"px"))}};c(a("zxxDragBg"),a("zxxCropBox"),"drag");c(a("dragLeftTop"),
a("zxxCropBox"),"nw");c(a("dragLeftBot"),a("zxxCropBox"),"sw");c(a("dragRightTop"),a("zxxCropBox"),"ne");c(a("dragRightBot"),a("zxxCropBox"),"se");c(a("dragTopCenter"),a("zxxCropBox"),"n");c(a("dragBotCenter"),a("zxxCropBox"),"s");c(a("dragRightCenter"),a("zxxCropBox"),"e");c(a("dragLeftCenter"),a("zxxCropBox"),"w");a("zxxImageCanvas").onselectstart=function(){return!1};e.onselectstart=function(){return!1}}}};